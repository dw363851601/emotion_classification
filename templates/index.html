<html>
  <head>
    <title>Pi Video Surveillance</title>
    <link rel="stylesheet" href="../static/reset.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/style.css"/>
  </head>
  <body>
  	<div class="container">

  	<div class="row">
    	<div class="col-sm">
    		<h1>Emo Trainer</h1>
    	</div>
	</div>

    <div class="row eq-height align-items-center">
			<img id="cam" class="img-fluid col-sm-9" src="{{ url_for('video_feed') }}">
			<!-- <img id="cam" class="img-fluid col-sm-9" src="../mock.jpg"/> -->

	    <div id="predictions" class="col-sm-3">
			<div class="progress" style="height:30px;">
				<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%; background-color: #FD0000;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"> Злость </div>
			</div>
			<div class="progress top20" style="height:30px;">
				<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%;background-color: #FD9900;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"> Счастье </div>
			</div>
			<div class="progress top20" style="height:30px;">
				<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%;background-color: #FFCD00;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"> Удивление </div>
			</div>
			<div class="progress top20" style="height:30px;">
				<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%;background-color: #67CC31;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"> Спокойствие</div>
			</div>
			<div class="progress top20" style="height:30px;">
				<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%;background-color: #3299FE;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"> Грусть </div>
			</div>
			<div class="progress top20" style="height:30px;">
				<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%;background-color: #1300CA;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"> Испуг </div>
			</div>
			<div class="progress top20" style="height:30px;">
				<div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%;background-color: #650297;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"> Отвращение </div>
			</div>
		</div>
	</div>

	<script>
    	const xhttp = new XMLHttpRequest();
    	function resetFace(){
    		xhttp.open("GET", "reset_face");
    		xhttp.send();
    	};
    </script>

	<div class="row">
		<div class="col-sm-4 top15">
			<input class="btn-lg btn-warning" value="Выбрать другое лицо" onclick="resetFace();" type="button">
		</div>
	</div>
	</div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> 
    <script>
    	$(document).ready(function() {
		    $("#cam").on("click", function(event) {
		        var x = event.pageX - this.offsetLeft;
		        var y = event.pageY - this.offsetTop;
		        var w = this.width;
		        var h = this.height;

		        xhttp.open("GET", `choose_face?x=${x}&y=${y}&w=${w}&h=${h}`);
		        xhttp.send();
		    });
		});
    </script>

    <script>
    	(function update() {
		    $.ajax({
		        type : 'GET',
		        url : 'get_emotions',
		        success : function(data){
		        	var bars = document.getElementById("predictions").children

		        	if (data.length > 0){
		        		//Злость
		        		bars[0].children[0].style.width = `${data[0]}%`
		        		//Счастье
		        		bars[1].children[0].style.width = `${data[3]}%`
		        		//Удивление
		        		bars[2].children[0].style.width = `${data[5]}%`
		        		//Спокойствие
		        		bars[3].children[0].style.width = `${data[6]}%`
		        		//Грусть
		        		bars[4].children[0].style.width = `${data[4]}%`
		        		//Испуг
		        		bars[5].children[0].style.width = `${data[2]}%`
		        		//Удивление
		        		bars[6].children[0].style.width = `${data[1]}%`

		        	} else {
		        		for (var i=0; i<7; i++){
		        			bars[i].children[0].style.width = '100%';
		        		}
		        	}
		        },              // pass existing options
		    }).then(function() {           // on completion, restart
		       setTimeout(update, 1000);  // function refers to itself
		    });
		})(); 
    </script>
  </body>
</html>